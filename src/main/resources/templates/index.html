<!doctype html>
<html lang="ch" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all">
    <link rel="icon" th:href="@{/img/favicon.ico}">
    <title>本草之本</title>
    <style>
        body{
            background-image: url("/img/jz.jpg");
            background-size: cover;
            background-attachment: fixed;
        }
        .login{
            background:rgb(255, 255, 255 ,0.3);
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -200px;
            margin: -190px;
            height: 400px;
            width: 380px;
            border-radius: 30px;
            text-align: center;
            padding: 40px;
            box-sizing: border-box;
            backdrop-filter: saturate(180%) blur(20px);
        }
        p{
            font: 900 30px '';
            margin: 40px;
            opacity: 0.8;
        }
        input{
            background:rgb(255, 255, 255 ,0.3);
            padding-left: 5px;
            margin-bottom: 10px;
            border: none;
            border-bottom: 2px solid black;
            outline: none;
            height: 35px;
            width: 100%;
            font-size: 20px;
        }
        .btn{
            margin-top: 20px;
            width: 40%;
            border: none;
            border-radius: 15px;
            background-color: aquamarine;
            padding-bottom: 3px;
            padding-left: 0;
        }
        #zc{
            margin-left: 6px;
        }
        #dr{
            margin-right: 6px;
        }
    </style>
</head>
<body>
<form class="login">
    <P>本草之本</P>
    <input id="a" type="text" placeholder="用户名">
    <input id="b" type="password" placeholder="密码">
    <input id="dr" class="btn" type="button" value="登 录" onclick="login()">
    <input id="zc" class="btn" type="button" value="注 册" onclick="han()">
</form>
<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/js/jquery.min.js}"></script>
<script>
    function login(){
        let name = $("#a").val();
        let password = $("#b").val();
        if (name == ''){
            layer.msg('用户名不能为空');
            return false;
        }
        if (password == '') {
            layer.msg('密码不能为空');
            return false;
        }
        $.ajax({
            url:'api/signin/login',
            data:JSON.stringify({
                name:name,
                password:password
            }),
            type:'POST',
            dataType:'json',
            timeout: 0,
            headers: {
                "Content-Type": "application/json"
            },
            success:function(response){
                if(response.code == 200){
                    localStorage.setItem('Authorization', response.data);
                    var settings = {
                        "url": "http://localhost:8000/api/user/",
                        "method": "GET",
                        "timeout": 0,
                        "headers": {
                            "Authorization": response.data
                        },
                    };
                    $.ajax(settings).done(function (data) {
                        console.log(data.data);
                        localStorage.setItem('user', JSON.stringify(data.data));
                    });
                    layer.msg('登录成功', {icon: 6, time:2000},function () {
                        window.location.href = "main";
                    });
                }else{
                    layer.msg('登录失败',{icon: 5,anim: 6});
                }
            }
        })
    }

    function han(){
        var index = layer.open({
            title: '注册',
            type: 1,
            shade: 0.2,
            btn: ['注册'],
            yes: function (){
                let name = $("#x").val();
                let password = $("#y").val();
                if (name == ''){
                    layer.msg('用户名不能为空');
                    return false;
                }
                if (password == '') {
                    layer.msg('密码不能为空');
                    return false;
                }
                $.ajax({
                    url:'api/signin/register',
                    data:JSON.stringify({
                        name:name,
                        password:password
                    }),
                    type:'POST',
                    dataType:'json',
                    timeout: 0,
                    headers: {
                        "Content-Type": "application/json"
                    },
                    success:function(response){
                        if(response.code == 200) {
                            layer.msg("注册成功",{icon: 6});
                            layer.close(index);
                        }else{
                            layer.msg(response.msg,{icon: 5,anim: 6});
                        }
                    }
                })
            },
            shadeClose: true,
            scrollbar: false,
            move: false,
            area: ['35%', '45%'],
            offset: 'auto',
            content: '<div>' +
                '<input id="x" style="width: 300px;margin: 0px auto;margin-bottom: 8px;margin-top: 20px;" type="text" name="" placeholder="请输入用户名" autocomplete="off" class="layui-input">' +
                '<input id="y" style="width: 300px;margin: 0px auto;" type="password" name="" placeholder="请输入密码" autocomplete="off" class="layui-input">' +
                '</div>'
        });
    }
</script>
</body>
</html>
